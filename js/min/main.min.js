function fillTable(){for(var t=$("#main tbody"),e=0,n=0;n<globalJSON.length;n++){var l=globalJSON[n],a=++e;console.log(l.name),t.append("<tr class='no-service no-print tr-title collapsed' data-node='"+a+"'><td></td><td class='td-title-name'><strong>"+l.name+"</strong></td><td></td><td></td><td></td></tr>");for(var s=0;s<l.services.length;s++){var i=l.services[s];console.log(i.type),++e,t.append("<tr class='no-print' data-node='"+e+"' data-pnode='"+a+"'><td>"+i.code+"</td><td class='td-name'>"+i.name+"</td><td class='count'></td><td class='price'>"+i.price+"</td><td class='unit'>"+i.unit+"</td></tr>")}}addResultField()}function collapseTable(){var t=$("#main tbody");t.find("tr").not(".no-service").hide(),$(".tr-title").click(function(){$(this).toggleClass("collapsed expanded");var e=$(this).data("node"),n=t.find("[data-pnode='"+e+"']");n.toggle()})}function getResult(){for(var t=$(".table tbody tr.success"),e=[],n=[],l=0;l<t.length;l++){var a=$(t[l]).find(".count").find("input").val();if(a>0){var s=+$(t[l]).find(".price").text(),i=s*a;e.push(i)}var d=+$(t[l]).find(".unit").text();n.push(d)}for(var o=0,r=0;r<e.length;r++)o+=e[r];this._resultPrice=$("#result"),this._resultPrice.html(o);for(var c=0,r=0;r<n.length;r++)c+=n[r];this._resultUnit=$("#unitCount"),this._resultUnit.html(c)}$(function(){fillTable(),collapseTable(),$("input").val("");var t="<input type='number' class='service-count' value='1' min='1'>";$(".table tbody tr").on("click",".service-count",function(t){t.stopPropagation()}),$(".table tbody tr").on("change",".service-count",function(){getResult()}),$("#datepicker").datepicker({autoclose:!0,todayBtn:"linked",clearBtn:!0,todayHighlight:!0,language:"ru"}).datepicker("setDate",new Date),$(".table tbody tr:not(.no-service)").click(function(){$(this).toggleClass("success no-print");var e=$(this).find(".count");$(this).hasClass("success")?e.append(t):e.empty(),getResult()}),$("td").on("focus","input[type=number]",function(){$(this).on("mousewheel.disableScroll",function(t){t.preventDefault()})}),$("td").on("blur","input[type=number]",function(){$(this).off("mousewheel.disableScroll")})});var addResultField=function(){var t=$("#main tbody");t.append("<tr class='no-service tr-result'><td></td><td class='title'>ИТОГ:</td><td></td><td id='result'></td><td id='unitCount'></td></tr>")};